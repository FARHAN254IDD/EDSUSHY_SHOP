# Edsushy Shop - Feature Map & User Flows

## ğŸ—ºï¸ Application Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Edsushy Shop App                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Firebase Backend                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ Authentication                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ Cloud Firestore (Database)                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ Cloud Storage (Images)                      â”‚  â”‚
â”‚  â”‚  â””â”€ Cloud Functions (M-Pesa Payments)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â–²                              â”‚
â”‚                          â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      State Management (7 Providers)              â”‚  â”‚
â”‚  â”‚  â”œâ”€ AuthProvider                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ CartProvider                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ ProductProvider                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ OrderProvider                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ PaymentProvider                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ UserProvider                                 â”‚  â”‚
â”‚  â”‚  â””â”€ ThemeProvider                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â–²                              â”‚
â”‚                          â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      UI Layer (Screens & Widgets)                â”‚  â”‚
â”‚  â”‚  â”œâ”€ Auth Screens (3)                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ Customer Screens (6)                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Admin Screens (2)                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ Settings Screens (3)                         â”‚  â”‚
â”‚  â”‚  â””â”€ Home Screens (2)                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‘¤ User Type Flows

### CUSTOMER USER FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App Launch  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AuthGate            â”‚
â”‚ (Check Auth Status) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â–º NOT LOGGED IN
       â”‚   â”‚
       â”‚   â–¼
       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  â”‚ LoginScreen      â”‚
       â”‚  â”‚  - Email/Pass    â”‚
       â”‚  â”‚  - Google Sign   â”‚
       â”‚  â”‚  - Guest Mode    â”‚
       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚           â”‚
       â”‚           â–¼
       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  â”‚ RegisterScreen   â”‚
       â”‚  â”‚  - Create Accountâ”‚
       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚           â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                      â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
       â”‚ Customer     â”‚         â”‚ Product      â”‚
       â”‚ HOME         â”‚         â”‚ Categories   â”‚
       â”‚ (LOGGED IN)  â”‚         â”‚              â”‚
       â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚      â”‚
       â”Œâ”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚Home  â”‚  â”‚Settings/Profileâ”‚
       â”‚Tab   â”‚  â”‚ - View Profile â”‚
       â”‚      â”‚  â”‚ - Dark/Light   â”‚
       â”‚Browseâ”‚  â”‚ - Help & FAQ    â”‚
       â”‚Prods â”‚  â”‚ - Contact      â”‚
       â”‚      â”‚  â”‚ - Logout       â”‚
       â””â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ProductListScreen â”‚
      â”‚  - All Products  â”‚
      â”‚  - Categories    â”‚
      â”‚  - Search Bar    â”‚
      â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚      â”‚
      â”Œâ”€â”€â–¼â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚Viewâ”‚ â”‚SearchProductsScreenâ”‚
      â”‚Det â”‚ â”‚ - Real-time search â”‚
      â”‚ail â”‚ â”‚ - Keywords         â”‚
      â””â”€â”€â”¬â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚  [Add to Cart]
         â”‚
         â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  CartScreen      â”‚
      â”‚  - View Items    â”‚
      â”‚  - Qty Controls  â”‚
      â”‚  - Subtotal      â”‚
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ [Checkout]
           â”‚
           â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚CheckoutScreen    â”‚
      â”‚ - Shipping Info  â”‚
      â”‚ - Order Summary  â”‚
      â”‚ - Payment Method â”‚
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ [Place Order]
           â”‚
           â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ PaymentScreen    â”‚
      â”‚ - M-Pesa Details â”‚
      â”‚ - STK Push       â”‚
      â”‚ - Verification   â”‚
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ [Payment Complete]
           â”‚
           â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Order Success    â”‚
      â”‚ Cart Cleared     â”‚
      â”‚ Back to Home     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ADMIN USER FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AuthGate            â”‚
â”‚ (Check Role)        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â–º ROLE = "ADMIN"
       â”‚   â”‚
       â”‚   â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ AdminHomeScreen      â”‚
       â”‚ 3 Tabs Navigation    â”‚
       â””â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚   â”‚    â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â” â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Prods â”‚ â”‚                  â”‚
    â”‚Mgmt  â”‚ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”
    â”‚Tab   â”‚ â”‚    â”‚Orders   â”‚Settinâ”‚
    â”‚      â”‚ â”‚    â”‚Mgmt Tab â”‚gs Tabâ”‚
    â””â”€â”€â”¬â”€â”€â”€â”˜ â”‚    â”‚         â”‚      â”‚
       â”‚     â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜     â”‚
       â”‚     â”‚           â”‚        â”‚
    â”Œâ”€â”€â–¼â”€â”€â” â”‚    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”      â”‚
    â”‚View â”‚ â”‚    â”‚(Coming â”‚      â”‚
    â”‚All  â”‚ â”‚    â”‚ Soon)  â”‚      â”‚
    â”‚Prodsâ”‚ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â””â”€â”€â”¬â”€â”€â”˜ â”‚                    â”‚
       â”‚    â”‚                    â”‚
    â”Œâ”€â”€â”´â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”
    â”‚Add New Product â”‚   â”‚(Coming)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ EditProductScreen    â”‚
    â”‚ - Product Name       â”‚
    â”‚ - Category           â”‚
    â”‚ - Price              â”‚
    â”‚ - Stock              â”‚
    â”‚ - Image URL          â”‚
    â”‚ - Description        â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ [Save/Update]
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Product Saved        â”‚
    â”‚ List Updated         â”‚
    â”‚ Back to Products     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Product Management   â”‚
    â”‚ Card Features:       â”‚
    â”‚ - Edit Product       â”‚
    â”‚ - Delete Product     â”‚
    â”‚ - View Details       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± Screen Navigation Map

```
                    AuthGate
                      â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                     â”‚
        NOT AUTH              AUTH
           â”‚                     â”‚
       LoginScreen          Check Role
           â”‚                     â”‚
           â”œâ”€â–º Register     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
           â”‚   Screen       â”‚         â”‚
           â”‚                â”‚         â”‚
           â–¼              ADMIN    CUSTOMER
        [Auth Done]         â”‚         â”‚
                            â”‚         â–¼
                            â”‚     HomeScreen
                            â”‚     (Navigation)
                            â”‚     â”œâ”€ Home Tab
                            â”‚     â”‚  (Products)
                            â”‚     â”‚
                            â”‚     â””â”€ Cart Tab
                            â”‚        (Cart)
                            â”‚
                            â–¼
                        AdminHome
                        (Dashboard)
                        â”œâ”€ Products Mgmt
                        â”œâ”€ Orders Mgmt
                        â””â”€ Settings
```

---

## ğŸ”„ Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              USER INTERACTIONS                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PROVIDERS (State)                      â”‚
â”‚                                                     â”‚
â”‚  AuthProvider â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º User Session              â”‚
â”‚  UserProvider â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º User Info & Role          â”‚
â”‚  ProductProvider â”€â”€â”€â”€â”€â”€â–º Products List             â”‚
â”‚  CartProvider â”€â”€â”€â”€â”€â”€â”€â”€â–º Shopping Cart              â”‚
â”‚  OrderProvider â”€â”€â”€â”€â”€â”€â”€â–º Orders Data                â”‚
â”‚  PaymentProvider â”€â”€â”€â”€â–º Payment Status              â”‚
â”‚  ThemeProvider â”€â”€â”€â”€â”€â”€â”€â–º App Theme                  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           FIREBASE BACKEND                         â”‚
â”‚                                                     â”‚
â”‚  Firestore Database                                â”‚
â”‚  â”œâ”€ users (collection)                             â”‚
â”‚  â”œâ”€ products (collection)                          â”‚
â”‚  â”œâ”€ orders (collection)                            â”‚
â”‚  â””â”€ payments (collection)                          â”‚
â”‚                                                     â”‚
â”‚  Cloud Functions                                   â”‚
â”‚  â”œâ”€ initiateMpesaPayment()                         â”‚
â”‚  â”œâ”€ handleMpesaCallback()                          â”‚
â”‚  â””â”€ checkPaymentStatus()                           â”‚
â”‚                                                     â”‚
â”‚  Cloud Storage                                     â”‚
â”‚  â””â”€ Product Images                                 â”‚
â”‚                                                     â”‚
â”‚  Authentication                                    â”‚
â”‚  â”œâ”€ Email/Password                                 â”‚
â”‚  â””â”€ Google Sign-In                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›’ Shopping Cart & Checkout Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ProductListScreen / ProductDetailScreen       â”‚
â”‚                                                 â”‚
â”‚   User views product details                   â”‚
â”‚   Clicks: [Add to Cart]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ CartProvider.addItem()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CartProvider                      â”‚
â”‚                                                â”‚
â”‚ - Stores items in map<productId, CartItem>   â”‚
â”‚ - Calculates totals                          â”‚
â”‚ - Tracks item count                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CartScreen                            â”‚
â”‚                                                â”‚
â”‚ Displays:                                     â”‚
â”‚ - All items                                   â”‚
â”‚ - Quantity controls (Â±)                       â”‚
â”‚ - Remove buttons                              â”‚
â”‚ - Subtotal per item                           â”‚
â”‚ - Total amount                                â”‚
â”‚                                                â”‚
â”‚ User clicks: [Proceed to Checkout]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CheckoutScreen                         â”‚
â”‚                                                â”‚
â”‚ Collects:                                     â”‚
â”‚ - Full Name                                   â”‚
â”‚ - Email                                       â”‚
â”‚ - Phone Number                                â”‚
â”‚ - Shipping Address                            â”‚
â”‚                                                â”‚
â”‚ Shows:                                        â”‚
â”‚ - Order Summary (items, subtotals)            â”‚
â”‚ - Total Amount                                â”‚
â”‚                                                â”‚
â”‚ Selection:                                    â”‚
â”‚ - Payment Method (M-Pesa / Card)              â”‚
â”‚                                                â”‚
â”‚ User clicks: [Place Order]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ OrderProvider.createOrder()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Order Created in Firestore                â”‚
â”‚                                                â”‚
â”‚ Order Document:                               â”‚
â”‚ {                                             â”‚
â”‚   id: unique_id                              â”‚
â”‚   userId: user_uid                           â”‚
â”‚   items: [...CartItems]                      â”‚
â”‚   totalAmount: 89999                         â”‚
â”‚   status: 'pending'                          â”‚
â”‚   paymentStatus: 'pending'                   â”‚
â”‚   shippingAddress: '...'                     â”‚
â”‚   createdAt: timestamp                       â”‚
â”‚ }                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PaymentScreen                          â”‚
â”‚                                                â”‚
â”‚ Displays:                                     â”‚
â”‚ - Payment amount                              â”‚
â”‚ - Phone number                                â”‚
â”‚ - Payment method (M-Pesa)                     â”‚
â”‚                                                â”‚
â”‚ User clicks: [Complete Payment]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ PaymentProvider.initiateMpesaPayment()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Firebase Cloud Function Triggered           â”‚
â”‚                                                â”‚
â”‚ 1. Get M-Pesa Access Token                    â”‚
â”‚ 2. Generate STK Push                          â”‚
â”‚ 3. Send to user's phone                       â”‚
â”‚ 4. Store payment request                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     User's Phone: M-Pesa Prompt                â”‚
â”‚                                                â”‚
â”‚ User enters M-Pesa PIN                        â”‚
â”‚                                                â”‚
â”‚ Safaricom processes payment                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Firebase Function Callback Handler            â”‚
â”‚                                                â”‚
â”‚ Payment Status: SUCCESS                       â”‚
â”‚                                                â”‚
â”‚ Updates in Firestore:                         â”‚
â”‚ - Order: paymentStatus = 'completed'          â”‚
â”‚ - Order: status = 'confirmed'                 â”‚
â”‚ - Order: transactionId = 'MPesa123...'        â”‚
â”‚                                                â”‚
â”‚ Clears CartProvider                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Order Success Message                        â”‚
â”‚   User navigated to HomeScreen                 â”‚
â”‚   Cart is empty                                â”‚
â”‚   Order visible in profile                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Authentication & Authorization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App Launch                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AuthGate (StreamBuilder)      â”‚
â”‚  Listens to authStateChanges   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
       â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
       â”‚             â”‚
       â–¼ NOT NULL    â–¼ NULL
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Logged In   â”‚  â”‚Not Logged In  â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚
          â”‚                â–¼
          â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚          â”‚  LoginScreen  â”‚
          â”‚          â”‚               â”‚
          â”‚          â”‚ Methods:      â”‚
          â”‚          â”‚ - Email/Pass  â”‚
          â”‚          â”‚ - Google      â”‚
          â”‚          â”‚ - Guest       â”‚
          â”‚          â”‚ - Forgot Pass â”‚
          â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚
          â”‚                  â–¼
          â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚          â”‚RegisterScreen â”‚
          â”‚          â”‚               â”‚
          â”‚          â”‚ Creates user: â”‚
          â”‚          â”‚ - Email       â”‚
          â”‚          â”‚ - Password    â”‚
          â”‚          â”‚ - Role=cust   â”‚
          â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Fetch User from DB â”‚
          â”‚ Check Role         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
            â”‚             â”‚
            â–¼             â–¼
        ADMIN=        CUSTOMER=
        admin_home    home_screen
        Dashboard     (Products)
```

---

## ğŸ“¦ Collections & Schema

```
FIRESTORE DATABASE
â”œâ”€â”€ users/
â”‚   â”œâ”€â”€ {uid}
â”‚   â”‚   â”œâ”€â”€ email: string
â”‚   â”‚   â”œâ”€â”€ role: string (admin|customer)
â”‚   â”‚   â”œâ”€â”€ createdAt: timestamp
â”‚   â”‚   â””â”€â”€ phone: string (optional)
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ products/
â”‚   â”œâ”€â”€ {productId}
â”‚   â”‚   â”œâ”€â”€ name: string
â”‚   â”‚   â”œâ”€â”€ description: string
â”‚   â”‚   â”œâ”€â”€ price: number
â”‚   â”‚   â”œâ”€â”€ category: string
â”‚   â”‚   â”œâ”€â”€ imageUrl: string
â”‚   â”‚   â”œâ”€â”€ stock: number
â”‚   â”‚   â”œâ”€â”€ rating: number
â”‚   â”‚   â”œâ”€â”€ reviewCount: number
â”‚   â”‚   â””â”€â”€ createdAt: timestamp
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ orders/
â”‚   â”œâ”€â”€ {orderId}
â”‚   â”‚   â”œâ”€â”€ userId: string (ref)
â”‚   â”‚   â”œâ”€â”€ items: array
â”‚   â”‚   â”‚   â””â”€â”€ {item}
â”‚   â”‚   â”‚       â”œâ”€â”€ productId
â”‚   â”‚   â”‚       â”œâ”€â”€ productName
â”‚   â”‚   â”‚       â”œâ”€â”€ price
â”‚   â”‚   â”‚       â””â”€â”€ quantity
â”‚   â”‚   â”œâ”€â”€ totalAmount: number
â”‚   â”‚   â”œâ”€â”€ status: string
â”‚   â”‚   â”œâ”€â”€ paymentMethod: string
â”‚   â”‚   â”œâ”€â”€ paymentStatus: string
â”‚   â”‚   â”œâ”€â”€ createdAt: timestamp
â”‚   â”‚   â”œâ”€â”€ deliveredAt: timestamp
â”‚   â”‚   â”œâ”€â”€ shippingAddress: string
â”‚   â”‚   â””â”€â”€ transactionId: string
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ payments/
    â”œâ”€â”€ {orderId}
    â”‚   â”œâ”€â”€ userId: string
    â”‚   â”œâ”€â”€ orderId: string
    â”‚   â”œâ”€â”€ phoneNumber: string
    â”‚   â”œâ”€â”€ amount: number
    â”‚   â”œâ”€â”€ status: string
    â”‚   â”œâ”€â”€ createdAt: timestamp
    â”‚   â”œâ”€â”€ mpesaRequestId: string
    â”‚   â””â”€â”€ completedAt: timestamp
    â””â”€â”€ ...
```

---

## ğŸ¯ Key User Actions

### Customer Actions
- âœ… Sign Up / Login
- âœ… Browse Products
- âœ… Search Products
- âœ… View Product Details
- âœ… Add to Cart
- âœ… Manage Cart Items
- âœ… Checkout
- âœ… Make Payment (M-Pesa)
- âœ… View Order History
- âœ… Track Orders
- âœ… Toggle Dark/Light Mode
- âœ… View FAQs
- âœ… Contact Support
- âœ… Logout

### Admin Actions
- âœ… Sign In
- âœ… View All Products
- âœ… Add Products
- âœ… Edit Products
- âœ… Delete Products
- âœ… View All Orders
- âœ… Manage Users
- âœ… View Payments
- âœ… Access Settings
- âœ… Logout

---

## ğŸ“Š Provider Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Multiple Providers              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ AuthProvider                            â”‚
â”‚  â”œâ”€ Uses: AuthService                  â”‚
â”‚  â””â”€ Notifies: UI on auth changes       â”‚
â”‚                                         â”‚
â”‚ UserProvider                            â”‚
â”‚  â”œâ”€ Reads from: Firestore (users)      â”‚
â”‚  â””â”€ Tracks: Current user & role        â”‚
â”‚                                         â”‚
â”‚ ProductProvider                         â”‚
â”‚  â”œâ”€ Reads from: Firestore (products)   â”‚
â”‚  â”œâ”€ Admin writes to: Firestore         â”‚
â”‚  â””â”€ Searches/Filters: In memory        â”‚
â”‚                                         â”‚
â”‚ CartProvider                            â”‚
â”‚  â”œâ”€ Stores: Local cart items           â”‚
â”‚  â””â”€ Manages: Qty & totals              â”‚
â”‚                                         â”‚
â”‚ OrderProvider                           â”‚
â”‚  â”œâ”€ Creates: Orders in Firestore       â”‚
â”‚  â”œâ”€ Reads: User's orders               â”‚
â”‚  â””â”€ Updates: Order status              â”‚
â”‚                                         â”‚
â”‚ PaymentProvider                         â”‚
â”‚  â”œâ”€ Calls: Cloud Functions             â”‚
â”‚  â””â”€ Tracks: Payment status             â”‚
â”‚                                         â”‚
â”‚ ThemeProvider                           â”‚
â”‚  â”œâ”€ Manages: Dark/Light mode           â”‚
â”‚  â””â”€ Applies: Theme to MaterialApp      â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

This feature map shows the complete user journey and system architecture for the Edsushy Shop application.
